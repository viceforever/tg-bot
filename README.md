# Telegram Collector

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø–µ—Ä–µ–ø–∏—Å–æ–∫ –≤ Telegram.

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π Telegram-–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —á–∞—Ç–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ä–µ–∞–∫—Ü–∏–∏
- –°–∫–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã (—Ñ–æ—Ç–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ, –≥–æ–ª–æ—Å–æ–≤—ã–µ) –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∏—Å–∫
- –•—Ä–∞–Ω–∏—Ç –≤ –ë–î –ø—É—Ç–∏ –∫ —Å–∫–∞—á–∞–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∞–π–ª–æ–≤ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- PostgreSQL
- Telegram Bot Token

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/viceforever/tg-bot.git
cd tg-bot
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL:
   - –î–ª—è Windows: —Å–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ (https://www.postgresql.org/download/windows/)
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pgAdmin –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

4. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL:
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É PostgreSQL
   - –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º `telegram_collector` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ `.env`)

5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` (—Å–º. —Ä–∞–∑–¥–µ–ª "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è")

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```env
# Telegram Bot Token
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather –≤ Telegram
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞

# Admin Telegram ID
# –í–∞—à Telegram ID (–º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ @userinfobot)
ADMIN_ID=–≤–∞—à_telegram_id

# PostgreSQL Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_NAME=telegram_collector
DB_USER=postgres
DB_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å

# –ü—É—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: ./downloads –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
DOWNLOAD_PATH=C:\–ø—É—Ç—å\–∫\–ø–∞–ø–∫–µ\downloads
```

### –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π .env —Ñ–∞–π–ª–∞:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
|----------|----------|--------------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather | –î–∞ |
| `ADMIN_ID` | –í–∞—à Telegram ID (—É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ @userinfobot) | –î–∞ |
| `DB_HOST` | –•–æ—Å—Ç PostgreSQL (–æ–±—ã—á–Ω–æ localhost) | –î–∞ |
| `DB_PORT` | –ü–æ—Ä—Ç PostgreSQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5432) | –î–∞ |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | –î–∞ |
| `DB_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PostgreSQL | –î–∞ |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å PostgreSQL | –î–∞ |
| `DOWNLOAD_PATH` | –ü—É—Ç—å –¥–ª—è —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ | –ù–µ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ./downloads) |

## –ó–∞–ø—É—Å–∫

```bash
python main.py
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–∑–¥–∞—é—Ç—Å—è –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
- –°–æ–∑–¥–∞—ë—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –Ω—É–∂–Ω—ã–µ —á–∞—Ç—ã/–≥—Ä—É–ø–ø—ã
2. –í—ã–¥–∞–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –±–æ—Ç—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —Å –±–æ—Ç–æ–º:

### –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---------|----------|--------|
| `/start` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º | `/start` |
| `/chats` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ | `/chats` |
| `/export <chat_id> <days>` | –≠–∫—Å–ø–æ—Ä—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ N –¥–Ω–µ–π | `/export -5148403988 7` |
| `/export_date <chat_id> <start> <end>` | –≠–∫—Å–ø–æ—Ä—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥ (YYYY-MM-DD) | `/export_date -5148403988 2026-01-01 2026-01-31` |
| `/files <chat_id> <days>` | –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª—ã –∑–∞ N –¥–Ω–µ–π | `/files -5148403988 7` |

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg-bot/
‚îú‚îÄ‚îÄ main.py                 # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å, —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ .env                    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ downloads/              # –°–∫–∞—á–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–Ω–µ –≤ git)
‚îÇ   ‚îî‚îÄ‚îÄ chat_<id>/
‚îÇ       ‚îî‚îÄ‚îÄ YYYY-MM/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ db_manager.py       # –ú–µ–Ω–µ–¥–∂–µ—Ä –ë–î
‚îú‚îÄ‚îÄ telegram_collector/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ collector.py        # –°–±–æ—Ä –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îî‚îÄ‚îÄ telegram_admin/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ admin_bot.py        # –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL —Å SQLAlchemy ORM. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

### –¢–∞–±–ª–∏—Ü–∞ `users`
- `id` - Telegram user ID (BigInteger, PK)
- `username` - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `first_name`, `last_name` - –ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

### –¢–∞–±–ª–∏—Ü–∞ `chats`
- `id` - Telegram chat ID (BigInteger, PK)
- `title` - –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞
- `chat_type` - –¢–∏–ø (private, group, supergroup, channel)
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏

### –¢–∞–±–ª–∏—Ü–∞ `messages`
- `id` - ID –∑–∞–ø–∏—Å–∏ (PK)
- `message_id` - ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
- `chat_id` - FK –Ω–∞ chats
- `user_id` - FK –Ω–∞ users
- `text` - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `message_date` - –î–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- `edited_date` - –î–∞—Ç–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–∞–±–ª–∏—Ü–∞ `reactions`
- `id` - ID –∑–∞–ø–∏—Å–∏ (PK)
- `message_id` - FK –Ω–∞ messages
- `emoji` - –≠–º–æ–¥–∑–∏ —Ä–µ–∞–∫—Ü–∏–∏
- `user_id` - –ö—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª —Ä–µ–∞–∫—Ü–∏—é

### –¢–∞–±–ª–∏—Ü–∞ `documents`
- `id` - ID –∑–∞–ø–∏—Å–∏ (PK)
- `message_id` - FK –Ω–∞ messages
- `file_id` - Telegram file_id
- `file_unique_id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ñ–∞–π–ª–∞
- `file_name` - –ò–º—è —Ñ–∞–π–ª–∞
- `mime_type` - MIME-—Ç–∏–ø
- `file_size` - –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
- `document_type` - –¢–∏–ø (photo, document, video, audio, voice)
- `file_path` - –õ–æ–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Å–∫–∞—á–∞–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É

## –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

–í—Å–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤:
- üì∑ **photo** - –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
- üìÑ **document** - –î–æ–∫—É–º–µ–Ω—Ç—ã (PDF, DOCX, –∏ —Ç.–¥.)
- üé• **video** - –í–∏–¥–µ–æ—Ñ–∞–π–ª—ã
- üéµ **audio** - –ê—É–¥–∏–æ—Ñ–∞–π–ª—ã
- üé§ **voice** - –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:

```
downloads/
‚îú‚îÄ‚îÄ chat_-1003652357491/           # –ü–∞–ø–∫–∞ —á–∞—Ç–∞ (–ø–æ chat_id)
‚îÇ   ‚îú‚îÄ‚îÄ 2026-01/                   # –ü–∞–ø–∫–∞ –º–µ—Å—è—Ü–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ photo_20260115_143022.jpg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report_20260115_143025.pdf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice_20260115_150000.ogg
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ video_20260116_120000.mp4
‚îÇ   ‚îî‚îÄ‚îÄ 2026-02/
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ chat_-1004567890123/
    ‚îî‚îÄ‚îÄ ...
```